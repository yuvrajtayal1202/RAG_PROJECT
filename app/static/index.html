<!DOCTYPE html>
<html>
<head>
    <title>Document QA System</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; }
        .container { max-width: 800px; margin: 0 auto; }
        .section { margin-bottom: 30px; padding: 20px; border: 1px solid #ddd; border-radius: 5px; }
        input, textarea, button { display: block; margin: 10px 0; padding: 10px; width: 100%; box-sizing: border-box; }
        button { background-color: #4CAF50; color: white; border: none; cursor: pointer; }
        button:hover { background-color: #45a049; }
        #answer, #uploadStatus { white-space: pre-wrap; background-color: #f9f9f9; padding: 15px; border-radius: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Document QA System</h1>
        
        <div class="section">
            <h2>Upload Document</h2>
            <input type="file" id="fileInput" accept=".pdf,.txt,.docx,.doc">
            <button onclick="uploadDocument()">Upload</button>
            <div id="uploadStatus"></div>
        </div>
        
        <div class="section">
            <h2>Ask a Question</h2>
            <textarea id="questionInput" rows="3" placeholder="Enter your question about the document"></textarea>
            <button onclick="askQuestion()">Ask Question</button>
            <div id="answer"></div>
        </div>
    </div>

    <script>
        async function uploadDocument() {
            const fileInput = document.getElementById('fileInput');
            const statusDiv = document.getElementById('uploadStatus');
            
            if (!fileInput.files.length) {
                statusDiv.innerHTML = 'Please select a file first.';
                return;
            }
            
            const formData = new FormData();
            formData.append('file', fileInput.files[0]);
            
            try {
                const response = await fetch('/upload/', {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                statusDiv.innerHTML = `Success: ${result.message}`;
            } catch (error) {
                statusDiv.innerHTML = `Error: ${error.message}`;
            }
        }

        async function askQuestion() {
    const questionInput = document.getElementById('questionInput');
    const answerDiv = document.getElementById('answer');
    
    if (!questionInput.value.trim()) {
        answerDiv.innerHTML = 'Please enter a question.';
        return;
    }
    
    try {
        answerDiv.innerHTML = 'Processing your question...';
        
        const response = await fetch('/ask/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ question: questionInput.value })
        });
        
        if (!response.ok) {
            const errorData = await response.json();
            throw new Error(errorData.detail || `Server error: ${response.status}`);
        }
        
        const result = await response.json();
        
        // Safely handle the response
        const answer = result.answer || "No answer provided";
        const sources = result.sources || ["No sources available"];
        
        // answerDiv.innerHTML = `<strong>Answer:</strong>\n${answer}\n\n<strong>Sources:</strong>\n${sources.join('\n\n')}`;
        // answerDiv.innerHTML = `<strong>Answer:</strong>\n${answer}\n`;
        answerDiv.innerHTML = answer;
        console.log(answer)
    } catch (error) {
        console.error('Error:', error);
        answerDiv.innerHTML = `Error: ${error.message}`;
    }
}
    </script>
</body>
</html>